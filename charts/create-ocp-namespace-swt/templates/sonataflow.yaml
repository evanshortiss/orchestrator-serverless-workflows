{{- $sonataflowFile := .Files.Get "manifests/05-sonataflow_create-ocp-namespace-swt.yaml.template" -}}
{{- $sonataflow := $sonataflowFile | fromYaml -}}
{{- $_ := set $sonataflow "metadata" (merge $sonataflow.metadata (dict "name" (include "create-ocp-namespace-swt.fullname" .) "labels" (include "create-ocp-namespace-swt.labels" .))) -}}
{{- $_ := set $sonataflow.spec.podTemplate.container "image" (printf "%s:%s" .Values.image.repository .Values.image.tag) -}}
{{- $_ := set $sonataflow.spec.podTemplate.container "envFrom" (list (dict "secretRef" (dict "name" (printf "%s-creds" (include "create-ocp-namespace-swt.fullname" .))))) -}}
{{- if .Values.persistence.postgresql -}}
{{- $_ := set $sonataflow.spec "persistence" (dict "postgresql" (dict "secretRef" (dict "name" .Values.persistence.postgresql.secretRef.name "userKey" .Values.persistence.postgresql.secretRef.userKey "passwordKey" .Values.persistence.postgresql.secretRef.passwordKey) "serviceRef" (dict "name" .Values.persistence.postgresql.serviceRef.name "port" .Values.persistence.postgresql.serviceRef.port "databaseName" .Values.persistence.postgresql.serviceRef.databaseName "databaseSchema" .Values.persistence.postgresql.serviceRef.databaseSchema))) -}}
{{- end -}}
{{- $sonataflow | toYaml }}
